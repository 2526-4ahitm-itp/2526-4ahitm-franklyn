name: ðŸ“¦ Auto-Archive Merged Branches

on:
  pull_request:
    types: [closed]


permissions:
  contents: write
jobs:
  archive-branch:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ“¦ Archive merged branch
        env:
          BRANCH_NAME: ${{ github.event.pull_request.head.ref }}
          DEFAULT_BRANCH: ${{ github.event.repository.default_branch }}
        run: |
          if [ "$BRANCH_NAME" = "$DEFAULT_BRANCH" ] || [[ "$BRANCH_NAME" == archived/* ]]; then
            echo "â­ï¸ Skipping: Branch is default branch or already archived"
            exit 0
          fi

          NEW_BRANCH_NAME="archived/$BRANCH_NAME"

          echo "ðŸ“¦ Archiving branch: $BRANCH_NAME -> $NEW_BRANCH_NAME"

          git fetch origin "$BRANCH_NAME"
          git branch "$NEW_BRANCH_NAME" "origin/$BRANCH_NAME"
          git push origin "$NEW_BRANCH_NAME"
          git push origin --delete "$BRANCH_NAME"

          echo "âœ… Successfully archived branch to $NEW_BRANCH_NAME"
